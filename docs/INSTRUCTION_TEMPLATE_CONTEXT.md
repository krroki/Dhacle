# 📋 INSTRUCTION_TEMPLATE.md 작업 컨텍스트

*다음 세션 AI를 위한 완전한 배경지식 문서*

---

## 🔴 문제의 본질 (왜 3일간 못 고쳤나)

### 실제 사례: "폴더 메뉴 로그인 화면 이동" 버그
```
증상: YouTube Lens 폴더 메뉴 → 로그인 화면 자동 이동
원인: 401 에러 처리 로직
기간: 3일간 해결 실패
```

**실패 원인:**
- AI가 2-3개 파일만 확인 → "전체 확인했다" 주장
- 추측 기반 해결책 제시 ("아마도 세션 문제")
- getSession → getUser 반복 시도 (이미 getUser 사용 중)
- 깊이 있는 분석 없이 표면적 수정만 반복

---

## 🚫 Claude Code의 나쁜 습관 목록

### 1. 얕은 분석 (Shallow Analysis)
```
❌ 현상: src/app/api 중 2-3개만 확인
✅ 필요: 38개 전체 route 확인
```

### 2. 추측 기반 작업 (Assumption-Based)
```
❌ "아마도", "~일 것입니다", "추정하건대"
✅ "verify:api Line 45에서 확인", "테스트 결과"
```

### 3. 부분 구현 (Partial Implementation)
```
❌ 컴포넌트만 생성, API 연결 X
✅ UI + API + 상태관리 + 에러처리 전체
```

### 4. 즉시 구현 (Rush to Code)
```
❌ 지시서 없이 바로 코드 작성
✅ 정보수집 → 지시서 → 확인 → 구현
```

### 5. 확인 생략 (Skip Verification)
```
❌ "완료했습니다" (테스트 X)
✅ npm run build, verify:all 통과 확인
```

---

## 📐 해결 전략: 메타-템플릿 접근

### 핵심 아이디어
"구현 가이드"가 아닌 "지시서 작성 템플릿"

### 구조 변경
```
이전: Phase 0-3가 구현 단계
개선: Phase 1-5가 지시서 작성 단계
```

### 강제 메커니즘
1. **정보 수집 강제**: 13개 문서 체계적 확인
2. **테스트 우선**: 추측 금지, 증거 기반
3. **사용자 확인**: 지시서 승인 후 작업
4. **깊이 강제**: "2-3개 X, 전체 확인"

---

## 🔄 재귀적 개선 방법론

### 검증 프로세스
```
1. 현재 문서로 10개 시나리오 테스트
2. 실패 원인 분석
3. 문서 개선 (v1, v2...)
4. 재테스트
5. 100% 달성까지 반복
```

### 실제 개선 과정
| 버전 | 성공률 | 핵심 개선 |
|------|--------|-----------|
| 현재 | 0% | 구현 가이드로 작성됨 |
| v1 | 70% | 지시서 작성 프로세스 추가 |
| v2 | 100% | 상황별 템플릿 추가 |

---

## 🧪 10개 검증 시나리오

### 설계 원칙
- 각각 다른 결의 문제 포함
- 실제 발생하는 요청 기반
- 모호함 정도 다양화

### 시나리오 목록
1. "폴더 메뉴 로그인 화면" - 구체적 버그
2. "버튼 추가해줘" - 극도로 모호
3. "검색 기능 넣어줘" - 부분 명확
4. "이거 왜 안 돼?" - 정보 부족
5. "느려" - 성능 문제
6. "새 테이블 만들어" - 체크리스트 필요
7. "다크모드 추가" - 시스템 레벨
8. "회원가입 만들어" - 복잡한 플로우
9. "에러 나" - 디버깅 필요
10. "전체적으로 개선" - 범위 불명확

---

## 📊 성공 메트릭

### 정량적 지표
- 시나리오 성공률: 100% 달성
- 지시서 작성률: 100% (구현 전)
- 사용자 확인률: 100%

### 정성적 지표
- "아마도" 사용: 0회
- 깊이 있는 분석: 전체 확인
- 증거 기반: 테스트 결과 인용

---

## 🎯 사용자 요구사항 (명시적)

### 1. 지시한 내용들
- "추측하지 말고 모든 내용 깊이 파악"
- "1-10까지 있다면 2-3만 확인하지 말 것"
- "10개 이상 시나리오로 100% 성공률까지"

### 2. 요구한 사항들
- 정확한 문제 파악
- 어디에 무엇을 어떻게 할지 명확히
- 재귀적 개선으로 완벽한 지시서

### 3. 문서 필요 이유
- 3일간 같은 문제 반복
- AI의 얕은 분석 습관
- 추측 기반 작업 방지

### 4. 이전 문제점들
- 401 에러 3일간 미해결
- getSession/getUser 반복
- API 일부만 확인

### 5. Claude의 나쁜 습관
- 2-3개만 확인
- "아마도" 사용
- 컴포넌트만 생성
- 바로 구현 시작

### 6. 해결 방식
- 메타-템플릿 접근
- 지시서 작성 강제
- 재귀적 개선

---

## 💡 암묵적 핵심 요소 (7개+)

### 1. 프로젝트 특성
- Dhacle: YouTube Shorts 교육 플랫폼
- Next.js 15.4.6 + Supabase
- 13개 핵심 문서 체계

### 2. 문서 진화 교훈
- Phase 구조가 핵심
- 상황별 템플릿 필수
- 예시가 중요

### 3. 인지적 함정
- AI는 "다 확인했다"고 착각
- 부분을 전체로 인식
- 패턴 매칭의 한계

### 4. 사용자 Frustration
- 반복 실패에 대한 피로
- 시간 낭비 스트레스
- 신뢰도 하락

### 5. 검증 설계 원리
- 실제 사례 기반
- 다양한 모호성 수준
- 측정 가능한 성공 기준

### 6. 문서 위계
- INSTRUCTION_TEMPLATE.md는 메타-문서
- 13개 문서 위에 있는 지시서 생성기
- AI 행동 수정 장치

### 7. 컨텍스트 관리
- Context 한계 인식
- 핵심만 압축 전달
- 연속성 보장

### 8. 패턴 언어
- "추측 금지" 반복 강조
- 구체적 파일명 명시
- 테스트 명령어 포함

### 9. 성공 요인
- 정보 수집 깊이
- 사용자 확인 과정
- 증거 기반 판단

### 10. 실패 카탈로그
- 각 시나리오별 실패 원인
- 공통 패턴 추출
- 개선 포인트 명확화

---

## 🚀 다음 세션 작업 가이드

### 현재 상태
- INSTRUCTION_TEMPLATE.md v2 완성 (100% 성공률)
- 10개 시나리오 모두 통과
- 재귀적 개선 3회 완료

### 남은 작업
1. **추가 엣지 케이스 검증**
   - 더 복잡한 시나리오 추가
   - 실제 사용 중 발견된 문제 반영

2. **문서 최적화**
   - 더 압축적 표현
   - 핵심 체크리스트 강화

3. **통합 테스트**
   - 실제 작업에 적용
   - 성공률 추적

### 핵심 파일
```
/docs/INSTRUCTION_TEMPLATE.md - 메인 템플릿
/docs/INSTRUCTION_TEMPLATE_CONTEXT.md - 이 문서
/CLAUDE.md - AI 작업 지침서
```

### 검증 명령어
```bash
# 문서 확인
cat docs/INSTRUCTION_TEMPLATE.md

# 시나리오 테스트 (수동)
"폴더 메뉴 로그인 문제" → 지시서 작성 확인
"버튼 추가" → 정보 수집 확인
```

---

## ⚠️ 절대 잊지 말 것

1. **추측 금지**: 테스트 결과만 신뢰
2. **깊이 있는 분석**: 2-3개 X, 전체 O
3. **지시서 우선**: 구현 전 반드시 작성
4. **사용자 확인**: 승인 후 작업
5. **13개 문서 활용**: 체계적 정보 수집

---

*이 문서는 INSTRUCTION_TEMPLATE.md 작업의 완전한 컨텍스트를 제공한다*