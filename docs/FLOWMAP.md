# 🗺️ 디하클 사용자 플로우맵

*목적: 페이지 간 이동과 인증 흐름*
*핵심 질문: "사용자가 어떻게 이동하지?"*
*최종 업데이트: 2025-01-31 - DOCUMENT_GUIDE 지침 반영*

---

## 🔐 인증 플로우

### 시나리오 1: 미인증 → 보호 페이지
```
사용자 → /tools/youtube-lens 클릭
    ↓
[401 응답 감지]
    ↓
자동 리다이렉트 → /auth/login
    ↓
카카오 로그인 성공
    ↓
원래 페이지로 복귀 (/tools/youtube-lens)
```

### 시나리오 2: 세션 만료
```
작업 중 → 세션 만료 (24시간)
    ↓
API 401 응답
    ↓
Toast: "세션이 만료되었습니다"
    ↓
3초 후 → /auth/login
```

---

## 📍 페이지별 접근 권한

| 페이지 경로 | 인증 필요 | 401 동작 | 구현 상태 |
|------------|----------|----------|----------|
| `/` (홈) | ❌ | - | ✅ |
| `/courses` | ❌ | - | ✅ |
| `/courses/[id]` | ❌ | - | ✅ |
| `/auth/login` | ❌ | - | ✅ |
| `/tools/youtube-lens` | ✅ | → 로그인 | ❌ |
| `/tools/youtube-lens/popular` | ✅ | → 로그인 | ❌ |
| `/tools/youtube-lens/collections` | ✅ | → 로그인 | ❌ |
| `/mypage` | ✅ | → 로그인 | ❌ |
| `/mypage/profile` | ✅ | → 로그인 | ❌ |
| `/mypage/courses` | ✅ | → 로그인 | ❌ |
| `/revenue-proof` | ✅ | → 로그인 | ⚠️ |
| `/community` | ⚠️ | 읽기만 가능 | ⚠️ |
| `/admin/*` | ✅ | → 403 페이지 | ❌ |
| `/settings/api-keys` | ✅ | → 로그인 | ❌ |
| `/payment/success` | ✅ | → 홈 | ⚠️ |
| `/payment/fail` | ✅ | → 홈 | ⚠️ |

---

## 🔄 주요 사용자 플로우

### 1. YouTube Lens 첫 사용
```
홈 → YouTube Lens 클릭
  ↓
[미인증] → 로그인 페이지
  ↓
카카오 로그인
  ↓
[API Key 없음] → API Key 설정 모달
  ↓
API Key 입력
  ↓
YouTube Lens 사용 시작
```

### 2. 강의 구매 플로우
```
강의 목록 → 강의 상세
  ↓
"수강 신청" 클릭
  ↓
[미인증] → 로그인 → 원래 페이지
[인증됨] → 결제 페이지
  ↓
TossPayments 결제
  ↓
성공: /payment/success → 강의 시청
실패: /payment/fail → 재시도
```

### 3. 수익 인증 작성
```
수익 인증 목록 → "작성" 버튼
  ↓
[미인증] → 로그인
  ↓
수익 인증 폼
  ↓
이미지 업로드 + 내용 작성
  ↓
제출 → 목록으로
```

### 4. 커뮤니티 활동
```
커뮤니티 게시글 목록 (누구나)
  ↓
게시글 읽기 (누구나)
  ↓
"댓글 작성" 클릭
  ↓
[미인증] → 로그인 필요 모달
  ↓
로그인 → 댓글 작성
```

---

## 🚨 에러 시나리오별 처리

### 네트워크 에러
```
API 요청 → Network Error
  ↓
Toast: "네트워크 연결을 확인해주세요"
  ↓
Retry 버튼 표시
```

### 권한 없음 (403)
```
관리자 페이지 접근 → 403
  ↓
Toast: "접근 권한이 없습니다"
  ↓
이전 페이지로 돌아가기
```

### 서버 에러 (500)
```
API 요청 → 500 Error
  ↓
Toast: "일시적인 오류가 발생했습니다"
  ↓
자동 재시도 (3회)
  ↓
실패 시 → 고객센터 안내
```

---

## 📱 모바일 특수 플로우

### 하단 네비게이션
```
모바일 → 하단 고정 Nav
  ↓
탭 전환 시 → 페이지 유지
  ↓
같은 탭 재클릭 → 최상단 스크롤
```

### 카카오 앱 로그인
```
모바일 브라우저 → 로그인 클릭
  ↓
카카오톡 앱 실행
  ↓
인증 완료 → 브라우저 복귀
  ↓
원래 페이지로 리다이렉트
```

---

## 🎯 구현 체크포인트

### Phase 1 (긴급)
- [ ] 모든 인증 필요 페이지에 401 체크
- [ ] 401 → 로그인 리다이렉트
- [ ] 로그인 후 원래 페이지 복귀

### Phase 2 (중요)
- [ ] API Key 설정 플로우
- [ ] 세션 만료 처리
- [ ] 에러별 Toast 메시지

### Phase 3 (개선)
- [ ] 로딩 상태 통일
- [ ] 에러 재시도 로직
- [ ] 모바일 최적화

---

*이 문서는 모든 페이지 작업 시 필수 참조*