/sc:test --seq --validate --evidence --e2e --playwright
"E2E 시나리오 - 전체 사용자 여정 검증"

# 🎬 E2E 시나리오 - 실제 사용자 여정 검증

**핵심**: 모든 Phase에서 실제 브라우저 테스트 필수

---

## 🚨 E2E 테스트 철학

### 원칙
```
컴파일 성공 ≠ 작동
타입 체크 통과 ≠ 작동
✅ 사용자가 실제로 클릭하고 사용 = 작동
```

### 테스트 환경
```bash
# 필수 준비
1. npm run dev 실행
2. http://localhost:3000 접속
3. Chrome DevTools 열기 (F12)
   - Console 탭 (에러 확인)
   - Network 탭 (API 확인)
4. 실제 클릭 테스트
```

---

## 📋 Phase별 필수 E2E 시나리오

### Phase 0: DB Truth & 타입 에러
```yaml
테스트_목표: 기본 페이지 로드 & API 연결

시나리오:
  1. 메인_페이지:
     - [ ] localhost:3000 접속 성공
     - [ ] 페이지 완전 로드 (3초 이내)
     - [ ] Console 에러 0개
  
  2. API_헬스체크:
     - [ ] /api/health → 200 OK
     - [ ] DB 연결 확인
     - [ ] 세션 체크 작동

증거_수집:
  - 메인 페이지 스크린샷
  - Console 탭 스크린샷
  - Network 탭 스크린샷
```

### Phase 1: 인증 E2E
```yaml
테스트_목표: 로그인부터 인증까지 완전 작동

시나리오:
  1. 로그인_플로우:
     - [ ] "로그인" 버튼 클릭
     - [ ] 카카오/구글 OAuth 선택
     - [ ] 로그인 완료 → 리다이렉트
     - [ ] 세션 쿠키 생성 확인
  
  2. 네이버_카페_인증:
     - [ ] /mypage/profile 접속
     - [ ] "네이버 카페 인증" 섹션
     - [ ] URL 입력: https://cafe.naver.com/dinohighclass
     - [ ] 닉네임 입력: TestUser123
     - [ ] "인증 요청" 클릭
     - [ ] "요청 접수" 토스트 확인
     - [ ] DB 저장 확인 (Supabase)
  
  3. 관리자_승인:
     - [ ] 관리자 계정 로그인
     - [ ] /admin 대시보드 접속
     - [ ] 인증 요청 목록 확인
     - [ ] "승인" 버튼 클릭
     - [ ] profiles.naver_cafe_verified = true

증거_수집:
  - 로그인 전/후 스크린샷
  - 인증 요청 화면
  - 관리자 승인 화면
  - DB 데이터 스크린샷
```

### Phase 2: 프로필 E2E
```yaml
테스트_목표: 프로필 편집 전체 기능 검증

시나리오:
  1. 프로필_편집:
     - [ ] /mypage/profile 접속
     - [ ] "편집" 버튼 클릭
     - [ ] 각 필드 수정
       * 닉네임: "테스트유저"
       * 소개: "안녕하세요"
       * 작업 유형: "프리랜서"
     - [ ] "저장" 클릭
     - [ ] "프로필이 업데이트되었습니다" 토스트
  
  2. 랜덤_닉네임:
     - [ ] "랜덤 생성" 버튼 클릭
     - [ ] 닉네임 자동 입력
     - [ ] 재생성 가능
  
  3. 이미지_업로드:
     - [ ] 프로필 이미지 클릭
     - [ ] 파일 선택 (JPG/PNG)
     - [ ] 미리보기 표시
     - [ ] 업로드 완료
     - [ ] 새로고침 후에도 유지

  4. 데이터_유지:
     - [ ] 페이지 새로고침 (F5)
     - [ ] 모든 데이터 유지 확인
     - [ ] 로그아웃/로그인 후 확인

증거_수집:
  - 편집 전/후 비교
  - 각 필드 수정 화면
  - 이미지 업로드 과정
```

### Phase 3: YouTube Lens E2E
```yaml
테스트_목표: YouTube Lens 핵심 기능 완전 작동

시나리오:
  1. 채널_검색:
     - [ ] /tools/youtube-lens 접속
     - [ ] 검색어: "프로그래밍"
     - [ ] Enter 또는 "검색" 클릭
     - [ ] 결과 리스트 표시 (5개 이상)
     - [ ] 로딩 스피너 작동
  
  2. 채널_상세:
     - [ ] 검색 결과에서 채널 클릭
     - [ ] 채널 정보 표시
       * 구독자 수
       * 비디오 수
       * 최근 업로드
     - [ ] "분석 시작" 버튼 활성화
  
  3. 알림_규칙:
     - [ ] "알림 설정" 버튼 클릭
     - [ ] 규칙 선택
       * 메트릭: "구독자 변화"
       * 조건: "> 1000"
     - [ ] "규칙 추가" 클릭
     - [ ] 규칙 목록에 표시
     - [ ] DB 저장 확인
  
  4. 즐겨찾기:
     - [ ] ⭐ 아이콘 클릭
     - [ ] 즐겨찾기 추가
     - [ ] 즐겨찾기 탭에서 확인

증거_수집:
  - 검색 결과 화면
  - 채널 상세 정보
  - 알림 규칙 설정
  - 즐겨찾기 목록
```

### Phase 4: 결제 E2E
```yaml
테스트_목표: 결제 전체 플로우 검증

시나리오:
  1. 상품_선택:
     - [ ] /pricing 페이지 접속
     - [ ] 상품 선택 (베이직/프로/엔터프라이즈)
     - [ ] "구매하기" 클릭
  
  2. 쿠폰_적용:
     - [ ] 결제 페이지에서 쿠폰 코드 입력
     - [ ] "WELCOME50" 입력
     - [ ] "적용" 클릭
     - [ ] 50% 할인 적용 확인
     - [ ] 최종 금액 재계산
  
  3. 결제_진행:
     - [ ] 결제 수단 선택 (카드/계좌이체)
     - [ ] 테스트 카드 정보 입력
       * 카드번호: 4242 4242 4242 4242
       * 유효기간: 12/34
       * CVC: 123
     - [ ] "결제하기" 클릭
  
  4. 결제_완료:
     - [ ] 결제 성공 페이지
     - [ ] 주문 번호 표시
     - [ ] 이메일 발송 확인
     - [ ] /mypage/orders에서 확인

증거_수집:
  - 상품 선택 화면
  - 쿠폰 적용 전/후
  - 결제 진행 화면
  - 완료 페이지
```

### Phase 5: 나머지 기능 E2E
```yaml
테스트_목표: 모든 기능 완전 작동 확인

시나리오:
  1. 수익_인증:
     - [ ] /revenue-proof/create 접속
     - [ ] 제목: "2025년 8월 수익"
     - [ ] 금액: 5,000,000원
     - [ ] 이미지 업로드
     - [ ] "저장" → 성공
     - [ ] 공유 URL 생성
     - [ ] 공유 링크 접속 가능
  
  2. 다크_모드:
     - [ ] 테마 토글 버튼 클릭
     - [ ] 다크 모드 전환
     - [ ] 모든 페이지 스타일 적용
     - [ ] 새로고침 후에도 유지
  
  3. 알림_센터:
     - [ ] 🔔 아이콘 클릭
     - [ ] 알림 목록 표시
     - [ ] 읽음 처리
     - [ ] 알림 설정 페이지
  
  4. 언어_전환:
     - [ ] 언어 선택 드롭다운
     - [ ] English 선택
     - [ ] UI 텍스트 변경 확인
     - [ ] 쿠키 저장 확인

증거_수집:
  - 각 기능 작동 영상
  - 전/후 비교 스크린샷
```

---

## 🔄 전체 사용자 여정 (Full E2E)

### 신규 사용자 Complete Journey
```bash
# 총 소요시간: 약 10분
# 테스트 방법: 수동 또는 Playwright 자동화

1. 첫 방문 (00:00)
   - 메인 페이지 로드
   - 서비스 소개 확인
   - "시작하기" 클릭

2. 회원가입 (00:30)
   - 카카오 로그인 선택
   - OAuth 인증
   - 프로필 자동 생성

3. 초기 설정 (01:00)
   - 랜덤 닉네임 생성
   - 작업 유형 선택
   - 프로필 이미지 업로드

4. 네이버 카페 인증 (02:00)
   - 카페 URL 입력
   - 닉네임 입력
   - 인증 요청

5. YouTube Lens 사용 (03:00)
   - 채널 검색
   - 채널 분석
   - 알림 규칙 설정
   - 즐겨찾기 추가

6. 유료 기능 구매 (05:00)
   - 상품 선택
   - 쿠폰 적용
   - 결제 진행
   - 구매 완료

7. 수익 인증 작성 (07:00)
   - 인증 작성
   - 이미지 업로드
   - 저장
   - 공유 링크 생성

8. 설정 변경 (09:00)
   - 다크 모드 전환
   - 언어 변경
   - 알림 설정

9. 로그아웃 (10:00)
   - 프로필 메뉴
   - 로그아웃 클릭
   - 메인 페이지로
```

---

## 🧪 자동화 테스트 (Playwright)

### 설치 및 설정
```bash
# Playwright 설치
npm install -D @playwright/test

# 브라우저 설치
npx playwright install
```

### 기본 테스트 구조
```typescript
// tests/e2e/full-journey.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Dhacle E2E Tests', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('http://localhost:3000');
  });

  test('메인 페이지 로드', async ({ page }) => {
    await expect(page).toHaveTitle(/Dhacle/);
    const startButton = page.locator('text=시작하기');
    await expect(startButton).toBeVisible();
  });

  test('로그인 플로우', async ({ page }) => {
    await page.click('text=로그인');
    // OAuth 처리...
  });

  test('프로필 편집', async ({ page }) => {
    // 로그인 상태 가정
    await page.goto('/mypage/profile');
    await page.fill('input[name="username"]', '테스트유저');
    await page.click('button:text("저장")');
    await expect(page.locator('.toast')).toContainText('업데이트');
  });
});
```

### 실행 명령
```bash
# 모든 테스트 실행
npx playwright test

# 특정 파일 실행
npx playwright test tests/e2e/full-journey.spec.ts

# UI 모드로 실행
npx playwright test --ui

# 디버그 모드
npx playwright test --debug
```

---

## 📊 테스트 커버리지 목표

### 필수 커버리지
```yaml
기능_커버리지:
  - 로그인/로그아웃: 100%
  - 프로필 관리: 100%
  - YouTube Lens: 90%
  - 결제: 100%
  - 수익 인증: 90%

페이지_커버리지:
  - 모든 public 페이지: 100%
  - 인증 필요 페이지: 100%
  - 관리자 페이지: 80%

API_커버리지:
  - 인증 API: 100%
  - CRUD API: 90%
  - 외부 연동: 80%
```

---

## 🚨 E2E 실패 시 대응

### 즉시 확인 사항
```bash
1. Console 에러 확인
   - 빨간색 에러 메시지
   - 경고 메시지

2. Network 실패 확인
   - 빨간색 요청
   - 4XX, 5XX 응답

3. DB 상태 확인
   - Supabase Dashboard
   - 테이블 데이터 확인

4. 세션 상태 확인
   - 쿠키 확인
   - localStorage 확인
```

### 디버깅 프로세스
```
1. 에러 재현
2. Console 로그 수집
3. Network 로그 수집
4. DB 쿼리 직접 실행
5. 코드 수정
6. 재테스트
```

---

## ✅ E2E 완료 체크리스트

### Phase별 체크
- [ ] Phase 0: 기본 로드 테스트 통과
- [ ] Phase 1: 인증 E2E 통과
- [ ] Phase 2: 프로필 E2E 통과
- [ ] Phase 3: YouTube Lens E2E 통과
- [ ] Phase 4: 결제 E2E 통과
- [ ] Phase 5: 전체 기능 E2E 통과

### 최종 확인
- [ ] 신규 사용자 전체 여정 통과
- [ ] 기존 사용자 시나리오 통과
- [ ] 관리자 시나리오 통과
- [ ] 에러 시나리오 통과
- [ ] 성능 기준 충족

---

## 🎯 성공 기준

```yaml
E2E_성공:
  페이지_로드: < 3초
  API_응답: < 500ms
  에러_율: < 0.1%
  사용자_만족: 100%
  
증거:
  - 전체 여정 녹화 영상
  - 각 Phase 스크린샷
  - 성능 메트릭 리포트
  - 에러 로그 (0개)
```

---

*E2E 시나리오 문서*
*핵심: 실제 브라우저에서 직접 클릭 테스트*
*목표: 100% 실제 작동 검증*