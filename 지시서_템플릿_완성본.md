# 🎯 디하클 프로젝트 맞춤형 지시서 템플릿 (완성본)

*Claude Code가 실수 없이 한번에 완벽한 구현을 위한 체계적 지시서 템플릿*

---

## 📋 템플릿 사용법

**입력**: PM AI D-SPEC 또는 사용자 요구사항 (간략 지시 ~ 상세 구현서)  
**출력**: 디하클 프로젝트 완전 맞춤형 구현 지시서  
**목표**: 실수 0%, 한번에 완성, 품질 보증

---

## 🎯 입력 유형 자동 분석

### Type A: 간략한 사용자 지시 (단일 작업)
- **예시**: "사용자 프로필 API 만들어줘", "로그인 컴포넌트 만들어줘"
- **특징**: 1개 주요 작업, 단일 폴더, 1-2개 서브에이전트, 30분 이내
- **출력**: 단일 구조 지시서

### Type B: 상세한 구현 지시서 (복합 작업)  
- **예시**: EPIC-01.md (사용자 인증 + 채널 생성 + 온보딩 플로우)
- **특징**: 여러 작업, 다중 폴더, 다수 서브에이전트, 1시간 이상
- **⚠️ 중요**: EPIC 문서는 표준 베스트 프랙티스 기반이므로, 디하클 프로젝트의 현재 상황과 차이가 있을 수 있음. 반드시 5가지      
  검증 체크리스트로 프로젝트 맞춤형 검증 후 진행 필수
- **출력**: Phase 분할 구조 지시서

---

## 📤 출력 형식 템플릿

### 🅰️ Type A 출력 템플릿 (간단한 작업)

```markdown
----------------
[작업 유형에 따른 최적 SC 명령어 & Flag]

간결하면서도 명확한 지시사항

## 🚨 필수 준수 사항 (CRITICAL REQUIREMENTS)
1. 추측 절대 금지: 사용자도 믿지말고 문서도 맹신하지말고 확인하고 검증된 데이터만 믿을 것
2. 전면적 검증: 모든것을 의심하고 검토하고 확인할것  
3. 즉시 참조: 조금이라도 막히거나 모호한 부분이 있다면 바로 C7에서 베스트프렉티스나 신뢰도 있는 정보를 찾아볼 것
4. 완전무결 목표: 단순 코드 작성이 목표가 아니라 아무런 오류없이 완전무결하게 작동하여 사용자가 쾌적하게 사용할수있는 사이트를 완성하는것이 목표
5. 컨텍스트 우선: 모든 작업은 명확한 context를 확인한 후 진행해야 함
----------------

## 🚀 1단계: 프로젝트 컨텍스트 자동 로딩 (30초 온보딩)
### 필수 실행 명령어
```bash
npm run context:load && cat ai-context-warmup.md
```
### 핵심 현황 즉시 파악
- **현재 상태**: Recovery Phase (검증 50% 성공, 품질 개선 중)
- **주요 이슈**: API 오류 18개, 타입 오류 2개, 보안 경고 58개
- **자산 현황**: 컴포넌트 96개, API Routes 40개, 테이블 22개

## 🗂️ 2단계: 작업 영역 & 서브에이전트 확인
- **주 작업 폴더**: [구체적 폴더 경로]
- **활성화 서브에이전트**: [해당 전문 에이전트]
- **필수 확인**: `cat [작업폴더]/CLAUDE.md`
- **보조 서브에이전트**: [필요시 추가 에이전트들]

## 🛡️ 3단계: 5가지 필수 검증 체크리스트

### A. [규약 준수] 코드 작성 패턴 일관성 ✅
- [ ] 해당 영역의 서브에이전트 CLAUDE.md 확인했는가?
- [ ] STOP-MUST-CHECK 3단계 규칙 준수했는가?
- [ ] `@/types`에서만 타입을 import했는가? (direct database 타입 금지)
- [ ] `api-client.ts` 통합 클라이언트 사용했는가? (direct fetch 금지)
- [ ] shadcn/ui 컴포넌트 우선 사용했는가?

**검증 명령어:**
```bash
grep -r "import.*from '\./database\.generated'" src/  # 직접 DB 타입 import 검사
find src/ -name "*.tsx" -exec grep -L "components/ui" {} \; # shadcn 미사용 확인
```

### B. [재사용성] 기존 에셋 중복 생성 방지 ✅
- [ ] `npm run scan:assets` 실행하여 기존 에셋 확인했는가?
- [ ] `components/common/`에서 재사용 가능한 컴포넌트 검색했는가?
- [ ] 40개 API Routes 중 유사한 패턴이 있는가?

### C. [데이터 무결성] 데이터베이스 스키마 충돌 검증 ✅
- [ ] users vs profiles 테이블 구분을 정확히 이해했는가?
- [ ] 22개 기존 테이블과의 관계를 확인했는가?
- [ ] RLS 정책이 필요한 테이블인가? (현재 0% 커버리지)

### D. [API 일관성] 엔드포인트 및 응답 형식 통일 ✅
- [ ] `requireAuth()` 헬퍼 함수를 사용했는가?
- [ ] 401 에러 응답이 표준 형식인가? `{ error: 'User not authenticated' }`
- [ ] snake_case ↔ camelCase 변환이 적용되었는가?

### E. [보안 및 정책] 인증 및 보안 규칙 준수 ✅
- [ ] 사용자별 데이터 필터링을 적용했는가? `.eq('user_id', user.id)`
- [ ] 환경변수를 `env.ts`를 통해 타입 안전하게 사용했는가?
- [ ] 민감한 정보가 로그에 출력되지 않는가?

## 🎯 4단계: 구현 사양 (디하클 맞춤형)
[구체적인 구현 지시사항과 코드 템플릿]

## 🚨 5단계: 22가지 실수 방지 실시간 차단

### 🔴 가장 위험한 5가지 패턴 우선 차단
1. **테이블 없이 기능 구현 시작 🔴🔴🔴**
2. **any 타입 남발 🔴🔴** 
3. **profiles vs users 테이블 혼란 🔴🔴**
4. **임시방편 코드 작성 🔴**
5. **서버/클라이언트 컨텍스트 혼용 🔴**

### STOP-MUST-CHECK 3단계 적용
#### 🛑 STOP - 즉시 중단 신호
- ❌ any 타입 발견 → 중단
- ❌ TODO 주석 발견 → 중단

#### ✅ MUST - 필수 행동 패턴
```typescript
import { env } from '@/env';
import type { User } from '@/types';
import { apiGet } from '@/lib/api-client';
```

#### 🔍 CHECK - 검증 필수
```bash
npm run verify:parallel
npm run types:check
```

## ✅ 6단계: 최종 품질 보증
### 검증 명령어
```bash
npm run verify:parallel                        # 전체 검증 (531ms)
npm run types:check                           # TypeScript 검증
[실제 동작 테스트 명령어]
```

### 성공 기준
- **검증 성공률**: 50% → 100% 목표
- **타입 안전성**: any 타입 0개
- **API 응답**: 200ms 이하
```

### 🅱️ Type B 출력 템플릿 (복합 작업)

```markdown
----------------
/sc:implement --validate --evidence --think-hard --c7 --seq

⚠️ **EPIC 검증 필수**: PM AI 작성 EPIC은 표준 베스트 프랙티스 기반이므로 현재 디하클 프로젝트와 차이 있을 수 있음. 5가지 검증    
   체크리스트로 완전 검증 후 진행

디하클 프로젝트 표준에 완벽히 준수하여 [복합 기능명]을 단계별로 오류 없이 구현하세요.

## 🚨 필수 준수 사항 (CRITICAL REQUIREMENTS)
[동일한 5가지 주의사항]
----------------

## 📋 TASK 분할 및 실행 순서

### 🔄 Phase 1: Database & Types (예상 시간: 20분)
**작업 폴더**: `supabase/migrations/`, `src/types/`
**활성화 서브에이전트**: Database Agent + Type Agent

### 🔄 Phase 2: API Development (예상 시간: 30분)  
**작업 폴더**: `src/app/api/`
**활성화 서브에이전트**: API Route Agent
**의존성**: Phase 1 완료 필수

### 🔄 Phase 3: Frontend Components (예상 시간: 25분)
**작업 폴더**: `src/components/`, `src/app/(pages)/`  
**활성화 서브에이전트**: Component Agent + Page Agent
**의존성**: Phase 1, 2 완료 필수

### 🔄 Phase 4: Integration & Testing (예상 시간: 15분)
**작업 폴더**: `tests/`
**활성화 서브에이전트**: Test Agent
**의존성**: Phase 1-3 완료 필수

## 🎯 각 Phase별 상세 지시사항
[각 Phase마다 위의 6단계 구조 적용]
```

---

## 📊 SC 명령어 & Flag 추천 시스템

### 작업 유형별 최적 조합

| 작업 유형 | SC 명령어 | 필수 Flag | 선택 Flag | 사용 상황 |
|-----------|----------|-----------|-----------|-----------|
| **API 개발** | `/sc:implement` | `--validate --evidence` | `--think-hard --c7 --seq` | 새 엔드포인트, 복잡한 비즈니스 로직 |
| **컴포넌트 개발** | `/sc:implement` | `--validate --c7` | `--evidence --think` | UI 컴포넌트, 복잡한 상호작용 |
| **데이터베이스 작업** | `/sc:implement` | `--validate --evidence --think-hard` | `--seq` | 스키마 변경, RLS 정책 |
| **버그 수정** | `/sc:troubleshoot` | `--validate --evidence --think` | `--seq --c7` | 복잡한 버그, 시스템 이슈 |
| **복합 작업** | `/sc:implement` | `--validate --evidence --think-hard --c7 --seq` | 없음 | EPIC 레벨, 다중 Phase |

---

## 🗂️ 16개 서브에이전트 자동 매핑

| 작업 폴더 | 활성화 서브에이전트 | 필수 확인 파일 | 주요 검증 항목 |
|-----------|-------------------|---------------|---------------|
| `src/app/api/**` | **API Route Agent** | `src/app/api/CLAUDE.md` | requireAuth 패턴, 401 표준화 |
| `src/components/**` | **Component Agent** | `src/components/CLAUDE.md` | shadcn/ui 우선, Server Component |
| `src/types/**` | **Type Agent** | `src/types/CLAUDE.md` | @/types 중앙화, any 타입 금지 |
| `supabase/migrations/**` | **Database Agent** | `supabase/migrations/CLAUDE.md` | RLS 정책, users vs profiles |
| `src/hooks/**` | **Query Agent** | `src/hooks/CLAUDE.md` | React Query 15개 패턴 |
| `tests/**` | **Test Agent** | `tests/CLAUDE.md` | E2E 테스트 7개 패턴 |
| `src/app/(pages)**` | **Page Agent** | `src/app/(pages)/CLAUDE.md` | Server Component 기본 |
| `src/lib/**` | **Lib Agent** | `src/lib/CLAUDE.md` | env.ts 사용, api-client |
| `scripts/**` | **Script Agent** | `scripts/CLAUDE.md` | verify-*.js만 허용 |
| `docs/**` | **Doc Agent** | `docs/CLAUDE.md` | Diátaxis 4분할 구조 |
| **보안 관련** | **Security Agent** | `src/lib/security/CLAUDE.md` | RLS 정책, XSS 방지 |

---

## 🛡️ 리스크 완화 시스템

### 1. 복잡성 과부하 해결책
- 📋 **우선순위 기반 실행**: 가장 위험한 5가지 패턴만 우선 차단
- 🎯 **단계별 진행**: 각 단계 완료 후 다음 단계 진행
- ⚡ **빠른 경로 제공**: 긴급 시 핵심 3단계만 실행 (STOP-MUST-CHECK)

### 2. 시스템 의존성 리스크 해결책
```bash
# 자동화 실패 시 수동 대체 방안
npm run context:load || echo "자동화 실패 - 수동 모드 전환"
cat docs/reference/project-status.md
cat docs/explanation/mistake-patterns.md
```

### 3. 버전 불일치 리스크 해결책
- 📚 **C7 실시간 참조**: 모호한 부분은 Context7에서 최신 베스트 프랙티스 확인
- 🔄 **점진적 적응**: 기존 패턴 + 새 패턴 병행 적용

---

## 📊 기존 vs 개선 비교표

| 구분 | 기존 버전 (사용자 예시) | 개선된 버전 (완성본) | 계승성 |
|------|----------------------|---------------------|-------|
| **핵심 철학** | PM AI D-SPEC → 프로젝트 맞춤형 변환 | PM AI D-SPEC → 디하클 완전 맞춤형 변환 | ✅ **100% 계승** |
| **5가지 체크리스트** | 1) 규약준수 2) 재사용성 3) 데이터무결성 4) API일관성 5) 보안정책 | **동일한 5가지 + 구체화** | ✅ **100% 계승 + 강화** |
| **검증 방식** | 수동 체크리스트 | 자동화 도구 + 수동 검증 | ✅ **계승 + 자동화** |
| **프로젝트 이해** | 수동으로 문서 찾기 | `npm run context:load` 30초 자동 | ⚡ **95% 시간 단축** |
| **작업 복잡도** | 단일 지시서만 지원 | Type A(단일) + Type B(복합) 지원 | 🚀 **확장 + 계승** |

---

## 📝 실제 사용 예시

### 🔸 Type A 예시: "사용자 프로필 API 만들어줘"

```markdown
----------------
/sc:implement --validate --evidence --c7

디하클 프로젝트 표준에 완벽히 준수하여 사용자 프로필 API를 오류 없이 구현하세요.

## 🚨 필수 준수 사항 (CRITICAL REQUIREMENTS)
1. 추측 절대 금지: 사용자도 믿지말고 문서도 맹신하지말고 확인하고 검증된 데이터만 믿을 것
2. 전면적 검증: 모든것을 의심하고 검토하고 확인할것  
3. 즉시 참조: 조금이라도 막히거나 모호한 부분이 있다면 바로 C7에서 베스트프렉티스나 신뢰도 있는 정보를 찾아볼 것
4. 완전무결 목표: 단순 코드 작성이 목표가 아니라 아무런 오류없이 완전무결하게 작동하여 사용자가 쾌적하게 사용할수있는 사이트를 완성하는것이 목표
5. 컨텍스트 우선: 모든 작업은 명확한 context를 확인한 후 진행해야 함
----------------

## 🚀 1단계: 필수 컨텍스트 로딩
```bash
npm run context:load && cat ai-context-warmup.md
```

## 🗂️ 2단계: 작업 영역 확인
- **주 작업 폴더**: `src/app/api/user/profile/`
- **활성화 서브에이전트**: API Route Agent
- **필수 확인**: `cat src/app/api/CLAUDE.md`

## 🛡️ 3단계: 5가지 검증 체크리스트
[전체 체크리스트 적용]

## 🎯 4단계: 구현 사양
[구체적 API 구현 지시사항]

## 🚨 5단계: 실수 방지 체크
[22가지 패턴 중 해당 항목들]

## ✅ 6단계: 최종 검증
[검증 명령어 및 성공 기준]
```

### 🔸 Type B 예시: EPIC-01 "사용자 인증 및 채널 생성 시스템"

```markdown
----------------
/sc:implement --validate --evidence --think-hard --c7 --seq

디하클 프로젝트 표준에 완벽히 준수하여 사용자 인증 및 채널 생성 시스템을 단계별로 오류 없이 구현하세요.

## 🚨 필수 준수 사항 (CRITICAL REQUIREMENTS)
[동일한 5가지 주의사항]
----------------

## 📋 TASK 분할 및 실행 순서

### 🔄 Phase 1: Database & Types (예상 시간: 20분)
**작업 폴더**: `supabase/migrations/`, `src/types/`
**활성화 서브에이전트**: Database Agent + Type Agent

### 🔄 Phase 2: API Development (예상 시간: 30분)
**작업 폴더**: `src/app/api/auth/`, `src/app/api/channels/`
**활성화 서브에이전트**: API Route Agent

### 🔄 Phase 3: Frontend Components (예상 시간: 25분)
**작업 폴더**: `src/components/features/auth/`, `src/components/features/channels/`
**활성화 서브에이전트**: Component Agent + Page Agent

### 🔄 Phase 4: Integration & Testing (예상 시간: 15분)
**작업 폴더**: `tests/e2e/`
**활성화 서브에이전트**: Test Agent

[각 Phase별로 6단계 구조 적용]
```

---

## 🎉 완성 요약

### ✅ **보존된 기존 시스템 (100% 계승)**
- 5가지 검증 체크리스트 (핵심 중의 핵심)
- PM AI D-SPEC → 프로젝트 맞춤형 변환 철학
- 30초 온보딩 시스템
- 16개 서브에이전트 매핑
- SC 명령어 & Flag 추천
- 22가지 실수 방지 패턴
- STOP-MUST-CHECK 3단계
- 5가지 강력한 주의사항
- 리스크 완화 방안

### 🆕 **새롭게 추가된 시스템**  
- **입력 유형 분석**: Type A(단일) vs Type B(복합) 자동 구분
- **복합 작업 TASK 분할**: Phase 1-4 체계적 관리
- **의존성 기반 실행**: 단계별 선행 조건 명시
- **시간 추정**: Phase별 예상 소요 시간

**결과**: 간단한 작업부터 복잡한 EPIC까지 모든 유형을 완벽 처리하는 완전한 지시서 템플릿 완성!