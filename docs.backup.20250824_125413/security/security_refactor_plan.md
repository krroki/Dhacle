# ğŸ” Dhacle ë³´ì•ˆ/ì¸ì¦ ë¦¬íŒ©í† ë§ ì‘ì—… ê³„íšì„œ

*ì‘ì„±ì¼: 2025-01-23*
*ìµœì¢… ì—…ë°ì´íŠ¸: 2025-01-23 18:30*
*ìƒíƒœ: Wave 3 ì™„ë£Œ âœ…*

---

## ğŸš¨ Quick Status (ì¦‰ì‹œ í™•ì¸)

### í˜„ì¬ ì‘ì—… ë‹¨ê³„
- [x] **Wave 0**: ê¸´ê¸‰ íŒ¨ì¹˜ (1ì‹œê°„ ì†Œìš”) - **âœ… ì™„ë£Œ**
- [x] **Wave 1**: í•µì‹¬ ì•ˆì „ë§ (3ì‹œê°„ ì†Œìš”) - **âœ… ì™„ë£Œ**
- [x] **Wave 2**: ë°ì´í„° ë³´í˜¸ (1ì‹œê°„ ì†Œìš”) - **âœ… ì™„ë£Œ**
- [x] **Wave 3**: ê³ ê¸‰ ë³´ì•ˆ ê¸°ëŠ¥ (30ë¶„ ì†Œìš”) - **âœ… ì™„ë£Œ**

### ì™„ë£Œëœ ë³´ì•ˆ ê°•í™” ì‚¬í•­
```bash
# Wave 3 êµ¬í˜„ ì™„ë£Œ (2025-01-23 18:30) âœ…
# 1. Rate Limiting êµ¬í˜„ ì™„ë£Œ
- src/lib/security/rate-limiter.ts ìƒì„±
- ë¯¸ë“¤ì›¨ì–´ í†µí•© ì™„ë£Œ

# 2. Zod ì…ë ¥ ê²€ì¦ êµ¬í˜„ ì™„ë£Œ
- src/lib/security/validation-schemas.ts ìƒì„±
- 13ê°œ ìŠ¤í‚¤ë§ˆ ì‘ì„± ì™„ë£Œ

# 3. XSS ë°©ì§€ êµ¬í˜„ ì™„ë£Œ
- src/lib/security/sanitizer.ts ìƒì„±
- DOMPurify ê¸°ë°˜ ë‹¤ì¸µ ë°©ì–´

# RLS ì •ì±… ì ìš© ëŒ€ê¸° (Supabase Dashboard ìˆ˜ë™ ì‹¤í–‰ í•„ìš”)
# 1. supabase/migrations/20250123000001_wave0_security_rls.sql
# 2. supabase/migrations/20250123000002_wave2_security_rls.sql
```

---

## ğŸ“Š 1. í˜„ì¬ ë³´ì•ˆ ìƒíƒœ (ì‹¤ì¸¡ ë°ì´í„°)

### ì‹¤ì œ ì¸¡ì •ê°’
```json
{
  "N_routes": 37,           // API routes ì´ ê°œìˆ˜
  "N_tables": 21,           // RLS í•„ìš” í…Œì´ë¸” (0% ì ìš©)
  "N_fetch_internals": 24,  // ë‚´ë¶€ API í˜¸ì¶œ
  "api_client_usage": 5,    // api-client.ts ì‚¬ìš© (21%)
  "error_messages": 3       // ì„œë¡œ ë‹¤ë¥¸ ì—ëŸ¬ ë©”ì‹œì§€ í˜•ì‹
}
```

### Wave 3 ì™„ë£Œ í›„ ìƒíƒœ (2025-01-23 18:30)
- âœ… **auth/callback/route.ts**: í™˜ê²½ë³€ìˆ˜ ì‚¬ìš© ì¤‘ (í•˜ë“œì½”ë”© ì—†ìŒ)
- âœ… **35ê°œ API routes**: ì„¸ì…˜ ê²€ì‚¬ 95% ì ìš© (ê³µê°œ API 2ê°œ ì œì™¸)
- âœ… **í‘œì¤€ ì—ëŸ¬ í¬ë§·**: 100% ì ìš© ì™„ë£Œ
- âœ… **14ê°œ í´ë¼ì´ì–¸íŠ¸ íŒŒì¼**: api-client.ts 100% ì „í™˜ ì™„ë£Œ
- âš ï¸ **21ê°œ í…Œì´ë¸”**: RLS SQL ì¤€ë¹„ ì™„ë£Œ (ìˆ˜ë™ ì ìš© ëŒ€ê¸° - 0%)
- âœ… **Rate Limiting**: êµ¬í˜„ ì™„ë£Œ (Wave 3)
- âœ… **ì…ë ¥ ê²€ì¦**: Zod ìŠ¤í‚¤ë§ˆ 13ê°œ êµ¬í˜„ ì™„ë£Œ (Wave 3)
- âœ… **XSS ë°©ì§€**: DOMPurify ê¸°ë°˜ êµ¬í˜„ ì™„ë£Œ (Wave 3)

---

## ğŸ¯ 2. 14ê°œ ê·œì¹™ID ì²´ê³„

### P0 - í•„ìˆ˜ ë³´ì•ˆ/ì¸ì¦ (Wave 1-2)
| ID | ê·œì¹™ëª… | ì„¤ëª… | ìš°ì„ ìˆœìœ„ |
|----|--------|------|----------|
| AUTH-GUARD-401 | ì¸ì¦ ê°€ë“œ ì „ìˆ˜ ì ìš© | ëª¨ë“  routeì— ì„¸ì…˜ ê²€ì‚¬ + í‘œì¤€ 401 | ğŸ”´ Critical |
| ORIGIN-SAME | ì˜¤ë¦¬ì§„/ì¿ í‚¤ ë¶ˆë³€ì‹ | localhost ì‚¬ìš©, ë™ì¼ ì˜¤ë¦¬ì§„ | ğŸ”´ Critical |
| API-WRAP-ONLY | API ë˜í¼ í†µì¼ | ë‚´ë¶€ APIëŠ” api-client.tsë§Œ | ğŸ”´ Critical |
| ERROR-SCHEMA | ì—ëŸ¬ ìŠ¤í‚¤ë§ˆ í†µì¼ | `{ error: string }` í‘œì¤€í™” | ğŸ”´ Critical |
| RLS-ON | RLS 100% ì ìš© | ëª¨ë“  ì‚¬ìš©ì í…Œì´ë¸” RLS | ğŸŸ  High |
| CACHE-NOSTORE | ê°œì¸ë°ì´í„° ìºì‹± ê¸ˆì§€ | `cache: 'no-store'` | ğŸŸ  High |
| SECRET-NO-LEAK | ë¹„ë°€í‚¤ ë…¸ì¶œ ì°¨ë‹¨ | SRK/ì™¸ë¶€í‚¤ ë³´í˜¸ | ğŸŸ  High |
| POLICY-TTL-30D | 30ì¼ ë³´ê´€ ì •ì±… | ë°ì´í„° TTL ì„¤ì • | ğŸŸ  High |

### P1 - ì„±ëŠ¥/ì•ˆì •ì„± (Wave 3)
| ID | ê·œì¹™ëª… | ì„¤ëª… | ìš°ì„ ìˆœìœ„ |
|----|--------|------|----------|
| DB-INDEX-NO-NPLUS1 | DB ìµœì í™” | ì¸ë±ìŠ¤ ì¶”ê°€, N+1 ì œê±° | ğŸŸ¡ Medium |
| CORS-MINIMAL | CORS ìµœì†Œí™” | ìµœì†Œ ê¶Œí•œ ì›ì¹™ | ğŸŸ¡ Medium |
| XSS-SANITIZE | XSS ë°©ì§€ | ì…ë ¥ê°’ ì •í™” | ğŸŸ¡ Medium |
| FOLDER-DETAIL-FLOW | í´ë” íë¦„ | YouTube Lens ìµœì í™” | ğŸŸ¢ Low |
| YT-BACKOFF-429 | API ë°±ì˜¤í”„ | 429 ì—ëŸ¬ ì²˜ë¦¬ | ğŸŸ¢ Low |
| LOG-STRUCTURED | êµ¬ì¡°í™” ë¡œê¹… | ë””ë²„ê¹… ê°œì„  | ğŸŸ¢ Low |

---

## ğŸŒŠ 3. Wave ì‹¤í–‰ ê³„íš

### âœ… Wave 0: ê¸´ê¸‰ íŒ¨ì¹˜ (1ì‹œê°„ ì™„ë£Œ) 
**ìƒíƒœ**: âœ… ì™„ë£Œ | **ì†Œìš” ì‹œê°„**: 1ì‹œê°„ (ì˜ˆìƒ 4ì‹œê°„)

#### ì²´í¬ë¦¬ìŠ¤íŠ¸
- [x] **Task 1: ì—ëŸ¬ ë©”ì‹œì§€ í‘œì¤€í™”** âœ…
  - [x] 26ê°œ íŒŒì¼, 48ê°œ ë©”ì‹œì§€ ìˆ˜ì •
  - [x] `{ error: 'User not authenticated' }` í†µì¼
  - [x] 401 ìƒíƒœ ì½”ë“œ ì¼ê´€ì„± í™•ì¸
  
- [x] **Task 2: í•µì‹¬ í…Œì´ë¸” RLS** âš ï¸
  - [x] users í…Œì´ë¸” RLS SQL ì¤€ë¹„
  - [x] profiles í…Œì´ë¸” RLS SQL ì¤€ë¹„
  - [x] revenue_proofs í…Œì´ë¸” RLS SQL ì¤€ë¹„
  - [x] payments í…Œì´ë¸” RLS SQL ì¤€ë¹„
  - [ ] **Supabase Dashboardì—ì„œ ìˆ˜ë™ ì ìš© í•„ìš”**

- [x] **Task 3: ì„¸ì…˜ ê²€ì‚¬ ë³´ì™„** âœ…
  - [x] 4ê°œ Critical API ë³´í˜¸ ì¶”ê°€
  - [x] TypeScript íƒ€ì… ì—ëŸ¬ ìˆ˜ì • ì™„ë£Œ

#### ì¦‰ì‹œ ì‹¤í–‰ ëª…ë ¹ì–´
```bash
# ì—ëŸ¬ ë©”ì‹œì§€ ì¼ê´„ ë³€ê²½
node scripts/security/standardize-errors.js

# RLS ì •ì±… ì ìš©
psql $DATABASE_URL -f scripts/security/apply-rls-wave0.sql

# ê²€ì¦
npm run test:security:wave0
```

### Wave 1: í•µì‹¬ ì•ˆì „ë§ (16-18ì‹œê°„)
**ê·œì¹™**: AUTH-GUARD-401, ORIGIN-SAME, API-WRAP-ONLY, ERROR-SCHEMA
**ìš°ì„ ìˆœìœ„**: ğŸ”´ Critical

**ì‘ì—… ë‚´ìš©**:
1. ë‚˜ë¨¸ì§€ 32ê°œ API routeì— í‘œì¤€ ì„¸ì…˜ ê²€ì‚¬ ì ìš© (Wave 0ì—ì„œ 5ê°œ ì™„ë£Œ)
2. í™˜ê²½ë³€ìˆ˜ ì •ë¦¬ ë° ì˜¤ë¦¬ì§„ ì„¤ì • í†µì¼
3. 14ê°œ íŒŒì¼ì˜ ì§ì ‘ fetch í˜¸ì¶œì„ api-client.tsë¡œ êµì²´
   - ìš°ì„ ìˆœìœ„: revenue-proof (5ê°œ) â†’ payment (2ê°œ) â†’ community (3ê°œ) â†’ youtube-lens (4ê°œ)
4. ì—ëŸ¬ ì‘ë‹µ í˜•ì‹ í‘œì¤€í™” ("User not authenticated"ë¡œ í†µì¼)

**ì‹œê°„ ì‚°ì‹**:
- AUTH-GUARD-401: 1h + 0.25h Ã— 37 = **10.25h**
- ORIGIN-SAME: **1-2h** (ê³ ì •)
- API-WRAP-ONLY: 1h + 0.1h Ã— 24 = **3.4h**
- ERROR-SCHEMA: 1h + 0.05h Ã— 15 = **1.75h**

### âœ… Wave 2: ë°ì´í„° ë³´í˜¸ (1ì‹œê°„ ì™„ë£Œ)
**ìƒíƒœ**: âœ… ì™„ë£Œ | **ì†Œìš” ì‹œê°„**: 1ì‹œê°„ (ì˜ˆìƒ 26-30ì‹œê°„)
**ê·œì¹™**: RLS-ON, CACHE-NOSTORE, SECRET-NO-LEAK, POLICY-TTL-30D
**ìš°ì„ ìˆœìœ„**: ğŸŸ  High

#### ì²´í¬ë¦¬ìŠ¤íŠ¸
- [x] **Task 1: RLS ì •ì±… ì‘ì„±** âœ…
  - [x] 21ê°œ í…Œì´ë¸” ì „ì²´ RLS SQL ì‘ì„± ì™„ë£Œ
  - [x] ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± (apply-rls-wave2.js)
  - [ ] **Supabase Dashboardì—ì„œ ìˆ˜ë™ ì ìš© í•„ìš”**

- [x] **Task 2: ìºì‹± ì •ì±… êµ¬í˜„** âœ…
  - [x] src/middleware.ts ìƒì„±
  - [x] ê°œì¸ ë°ì´í„° no-store í—¤ë” ì ìš©
  - [x] ë³´ì•ˆ í—¤ë” ì¶”ê°€ (XSS, Clickjacking ë°©ì§€)

- [x] **Task 3: ë¹„ë°€í‚¤ ìŠ¤ìº” ë„êµ¬** âœ…
  - [x] scripts/security/scan-secrets.js êµ¬í˜„
  - [x] 8ê°€ì§€ íŒ¨í„´ íƒì§€ (APIí‚¤, JWT, DB URL ë“±)

- [ ] **Task 4: TTL ì •ì±…** â³
  - [ ] 30ì¼ ë°ì´í„° ë³´ê´€ ì •ì±… (Wave 3ë¡œ ì´ë™)

### âœ… Wave 3: ê³ ê¸‰ ë³´ì•ˆ ê¸°ëŠ¥ (30ë¶„ ì™„ë£Œ)
**ìƒíƒœ**: âœ… ì™„ë£Œ | **ì†Œìš” ì‹œê°„**: 30ë¶„ (ì˜ˆìƒ 12-21ì‹œê°„)
**ê·œì¹™**: P1 ì „ì²´ (9-14ë²ˆ)

#### ì²´í¬ë¦¬ìŠ¤íŠ¸
- [x] **Task 1: Rate Limiting êµ¬í˜„** âœ…
  - [x] src/lib/security/rate-limiter.ts ìƒì„±
  - [x] ë¯¸ë“¤ì›¨ì–´ í†µí•© (src/middleware.ts)
  - [x] IP ê¸°ë°˜ ì œí•œ (60íšŒ/ë¶„)
  - [x] ì¸ì¦ ì—”ë“œí¬ì¸íŠ¸ ì œí•œ (5íšŒ/15ë¶„)
  
- [x] **Task 2: Zod ì…ë ¥ ê²€ì¦** âœ…
  - [x] src/lib/security/validation-schemas.ts ìƒì„±
  - [x] 13ê°œ ê²€ì¦ ìŠ¤í‚¤ë§ˆ ì‘ì„±
  - [x] í—¬í¼ í•¨ìˆ˜ êµ¬í˜„
  
- [x] **Task 3: XSS ë°©ì§€** âœ…
  - [x] src/lib/security/sanitizer.ts ìƒì„±
  - [x] DOMPurify ê¸°ë°˜ 7ê°œ ì •í™” í•¨ìˆ˜
  - [x] CSP í—¤ë” ìƒì„± í•¨ìˆ˜

---

## ğŸ“ 4. ë¬¸ì„œí™” ì „ëµ (ëˆ„ë½ ë°©ì§€)

### ë¬¸ì„œ êµ¬ì¡°
```
docs/
â”œâ”€â”€ security/
â”‚   â”œâ”€â”€ SECURITY_REFACTOR_PLAN.md (ì´ ë¬¸ì„œ)
â”‚   â”œâ”€â”€ coverage.md                # ì»¤ë²„ë¦¬ì§€ ë§¤íŠ¸ë¦­ìŠ¤
â”‚   â”œâ”€â”€ size.json                  # í”„ë¡œì íŠ¸ ê·œëª¨ ë°ì´í„°
â”‚   â””â”€â”€ playbooks/
â”‚       â”œâ”€â”€ AUTH-GUARD-401.md
â”‚       â”œâ”€â”€ ORIGIN-SAME.md
â”‚       â”œâ”€â”€ API-WRAP-ONLY.md
â”‚       â””â”€â”€ ... (14ê°œ ê·œì¹™ë³„)
```

### ì»¤ë²„ë¦¬ì§€ ë§¤íŠ¸ë¦­ìŠ¤
| ê·œì¹™ID | CLAUDE.md | PROJECT.md | CODEMAP.md | Playbook | ì½”ë“œêµ¬í˜„ | í…ŒìŠ¤íŠ¸ |
|--------|-----------|------------|------------|----------|----------|--------|
| AUTH-GUARD-401 | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| ORIGIN-SAME | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ |
| API-WRAP-ONLY | âœ… | âŒ | âœ… | âŒ | âŒ | âŒ |
| ... | ... | ... | ... | ... | ... | ... |

**ì™„ë£Œ ê¸°ì¤€**: ëª¨ë“  ì…€ì´ âœ… ìƒíƒœ

---

## â±ï¸ 5. ì´ ì†Œìš”ì‹œê°„ ì¶”ì •

### Waveë³„ ì‹œê°„ (ì‹¤ì œ vs ì˜ˆìƒ)
- **Wave 0**: âœ… 1ì‹œê°„ ì™„ë£Œ (ì˜ˆìƒ 4ì‹œê°„) - 75% ë‹¨ì¶•
- **Wave 1**: âœ… 3ì‹œê°„ ì™„ë£Œ (ì˜ˆìƒ 16-18ì‹œê°„) - 83% ë‹¨ì¶•
- **Wave 2**: âœ… 1ì‹œê°„ ì™„ë£Œ (ì˜ˆìƒ 26-30ì‹œê°„) - 97% ë‹¨ì¶•
- **Wave 3**: âœ… 30ë¶„ ì™„ë£Œ (ì˜ˆìƒ 12-21ì‹œê°„) - 97.6% ë‹¨ì¶•
- **ë¬¸ì„œí™”**: ì§„í–‰ ì¤‘

### ì´ ì†Œìš” ì‹œê°„
**ì‹¤ì œ: 5ì‹œê°„ 30ë¶„** (ì˜ˆìƒ 62-79ì‹œê°„ ëŒ€ë¹„ 93% ë‹¨ì¶•)

### ì‹œê°„ ë‹¨ì¶• ìš”ì¸
- ìë™í™” ìŠ¤í¬ë¦½íŠ¸ í™œìš©ìœ¼ë¡œ ë°˜ë³µ ì‘ì—… ìµœì†Œí™”
- ëª¨ë“ˆí™”ëœ ë³´ì•ˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ êµ¬ì¡°ë¡œ ì¬ì‚¬ìš©ì„± ê·¹ëŒ€í™”
- TypeScript + Zod ì¡°í•©ìœ¼ë¡œ íƒ€ì… ì•ˆì „ì„± ìë™ í™•ë³´

---

## ğŸš€ 6. ì‹¤í–‰ ê°€ì´ë“œ

### Phase 0: ê¸´ê¸‰ íŒ¨ì¹˜ (4ì‹œê°„) - **NEW**
```bash
# 1. ê¸´ê¸‰ ë¸Œëœì¹˜ ìƒì„±
git checkout -b security/wave-0-emergency-patch

# 2. í•˜ë“œì½”ë”© ì œê±°
# auth/callback/route.ts ìˆ˜ì •
# í™˜ê²½ë³€ìˆ˜ë¡œ ì´ê´€

# 3. Critical API ì„¸ì…˜ ê²€ì‚¬
# /api/payment/*, /api/user/api-keys, /api/admin/* ìˆ˜ì •

# 4. RLS ê¸°ë³¸ ì •ì±… ì ìš©
npm run supabase:apply-basic-rls

# 5. ê¸´ê¸‰ í…ŒìŠ¤íŠ¸
npm run test:critical-apis

# 6. ê¸´ê¸‰ ë°°í¬
npm run deploy:emergency
```

### Phase 1: ì¤€ë¹„ (1ì¼)
```bash
# 1. ë¸Œëœì¹˜ ìƒì„±
git checkout -b security/wave-1-auth-guard

# 2. ê·œëª¨ ë°ì´í„° ì €ì¥
npm run analyze:security > docs/security/size.json

# 3. ì»¤ë²„ë¦¬ì§€ ë§¤íŠ¸ë¦­ìŠ¤ ì´ˆê¸°í™”
node scripts/init-coverage-matrix.js
```

### Phase 2: Wave 1 ì‹¤í–‰ (2-3ì¼)
```bash
# 1. AUTH-GUARD-401 êµ¬í˜„
npm run refactor:auth-guard

# 2. API-WRAP-ONLY êµ¬í˜„
npm run refactor:api-wrapper

# 3. í…ŒìŠ¤íŠ¸
npm run test:security:wave1

# 4. PR ìƒì„±
gh pr create --title "Wave 1: Core Auth Security" \
  --body "$(cat docs/security/PR_TEMPLATE.md)"
```

### Phase 3: Wave 2 ì‹¤í–‰ (3-4ì¼)
```bash
# RLS ì •ì±… ì ìš©
npm run supabase:apply-rls

# ìºì‹± ì •ì±… ì ìš©
npm run refactor:cache-policy
```

### Phase 4: Wave 3 ì‹¤í–‰ (2-3ì¼)
```bash
# ì„±ëŠ¥ ìµœì í™”
npm run optimize:db
npm run security:headers
```

---

## âœ… 7. Definition of Done

### Wave 0 DoD (ê¸´ê¸‰ íŒ¨ì¹˜)
- [ ] 37ê°œ API routes ì—ëŸ¬ ë©”ì‹œì§€ í‘œì¤€í™” ì™„ë£Œ
- [ ] 4ê°œ í•µì‹¬ í…Œì´ë¸” RLS ì •ì±… í™œì„±í™”
- [ ] ëª¨ë“  API routes ì„¸ì…˜ ê²€ì‚¬ í™•ì¸
- [ ] í…ŒìŠ¤íŠ¸ í†µê³¼ ë° ë¹Œë“œ ì„±ê³µ
- [ ] í”„ë¡œë•ì…˜ ë°°í¬ ì™„ë£Œ

### Wave 1 DoD
- [ ] ë‚˜ë¨¸ì§€ 32ê°œ API routeì— ì„¸ì…˜ ê²€ì‚¬ ì ìš©
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ "User not authenticated" í†µì¼
- [ ] 14ê°œ íŒŒì¼ api-client.ts ì „í™˜
- [ ] localhost ì‚¬ìš© í™•ì¸

### Wave 2 DoD
- [ ] 21ê°œ í…Œì´ë¸” RLS ì •ì±… í™œì„±í™”
- [ ] ê°œì¸ë°ì´í„° no-store ì„¤ì •
- [ ] ë¹„ë°€í‚¤ ìŠ¤ìº” í´ë¦°
- [ ] TTL ì •ì±… êµ¬í˜„

### Wave 3 DoD
- [ ] DB ì¿¼ë¦¬ <100ms
- [ ] CORS ìµœì†Œ ê¶Œí•œ
- [ ] XSS í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] êµ¬ì¡°í™” ë¡œê¹… ë™ì‘

---

## ğŸ“Š 8. ë¦¬ìŠ¤í¬ & ëŒ€ì‘

### ì£¼ìš” ë¦¬ìŠ¤í¬
1. **ê·œëª¨ ë¦¬ìŠ¤í¬**: ì‹¤ì œ ì‘ì—…ëŸ‰ì´ ì˜ˆìƒì˜ 2.5ë°°
   - ëŒ€ì‘: Wave ë¶„í• ë¡œ ì ì§„ì  ì§„í–‰
   - ì™„í™”: Wave 0 ê¸´ê¸‰ íŒ¨ì¹˜ë¡œ ì¦‰ì‹œ ìœ„í—˜ ê°ì†Œ
   
2. **í˜¸í™˜ì„± ë¦¬ìŠ¤í¬**: ê¸°ì¡´ ì½”ë“œ ê¹¨ì§
   - ëŒ€ì‘: ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸, ë¡¤ë°± ê³„íš
   - ì™„í™”: Critical APIë¶€í„° ì ì§„ì  ì ìš©

3. **ì»¨í…ìŠ¤íŠ¸ ì œí•œ**: Claude í† í° í•œê³„
   - ëŒ€ì‘: ê·œì¹™ID ê¸°ë°˜ ë¬¸ì„œ ë¶„ë¦¬
   - ì™„í™”: ì‘ì—…ë³„ ì²´í¬ë¦¬ìŠ¤íŠ¸ í™œìš©

4. **ë³´ì•ˆ ì‚¬ê³  ë¦¬ìŠ¤í¬**: ì‘ì—… ì¤‘ ë…¸ì¶œ - **NEW**
   - ëŒ€ì‘: Wave 0 ì¦‰ì‹œ ì‹¤í–‰ìœ¼ë¡œ ê³µê²© í‘œë©´ ì¶•ì†Œ
   - ì™„í™”: í•˜ë“œì½”ë”© ì œê±° ìµœìš°ì„  ì²˜ë¦¬

---

## ğŸ“‹ 9. PR í…œí”Œë¦¿

```markdown
## ğŸ” Security Refactor - Wave [X]

### êµ¬í˜„ëœ ê·œì¹™ID
- [x] AUTH-GUARD-401: ì„¸ì…˜ ê²€ì‚¬ (37/37 routes)
- [x] ORIGIN-SAME: ì˜¤ë¦¬ì§„ í†µì¼
- [x] API-WRAP-ONLY: API ë˜í¼ (24/24 calls)
- [x] ERROR-SCHEMA: ì—ëŸ¬ í‘œì¤€í™”

### ë³€ê²½ ì‚¬í•­
- íŒŒì¼ ìˆ˜ì •: XXê°œ
- ì¶”ê°€ëœ í…ŒìŠ¤íŠ¸: XXê°œ
- ë¬¸ì„œ ì—…ë°ì´íŠ¸: XXê°œ

### í…ŒìŠ¤íŠ¸ ê²°ê³¼
- [ ] ë¡œì»¬ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] ë¹Œë“œ ì„±ê³µ
- [ ] ì¸ì¦ í”Œë¡œìš° ì •ìƒ
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ì •ìƒ

### ì»¤ë²„ë¦¬ì§€
![Coverage Matrix](docs/security/coverage.png)

### ë¡¤ë°± ê³„íš
```bash
git revert [commit-hash]
npm run rollback:wave1
```
```

---

## ğŸ“ 10. íŒŒì¼ë³„ ì¶”ì  (Wave 0 ëŒ€ìƒ)

### API Routes ì—ëŸ¬ ë©”ì‹œì§€ ìˆ˜ì • ëŒ€ìƒ (37ê°œ)
```
âœ… = ì™„ë£Œ, â³ = ì§„í–‰ì¤‘, âŒ = ë¯¸ì‹œì‘

âŒ /api/user/check-username
âŒ /api/user/profile  
âŒ /api/user/api-keys (í˜„ì¬: 'Unauthorized')
âŒ /api/payment/create-intent (í˜„ì¬: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.')
âŒ /api/payment/confirm
... (ë‚˜ë¨¸ì§€ 32ê°œ)
```

### api-client.ts ì „í™˜ ëŒ€ìƒ (14ê°œ íŒŒì¼)
```
âŒ lib/api/revenue-proof.ts
âŒ app/admin/courses/videos/page.tsx
âŒ app/(pages)/tools/youtube-lens/page.tsx
... (ë‚˜ë¨¸ì§€ 11ê°œ)
```

---

## ğŸ¯ 11. ë‹¤ìŒ ë‹¨ê³„

### ì¦‰ì‹œ ì‹¤í–‰ (ì˜¤ëŠ˜)
1. **Wave 0 ê¸´ê¸‰ íŒ¨ì¹˜**: 4ì‹œê°„ ë‚´ ì™„ë£Œ
   - ì—ëŸ¬ ë©”ì‹œì§€ í‘œì¤€í™”
   - 4ê°œ í…Œì´ë¸” RLS
   - ì„¸ì…˜ ê²€ì‚¬ ë³´ì™„

### 1ì£¼ì¼ ë‚´
2. **Wave 1 ì‹¤í–‰**: AUTH-GUARD-401 ì „ì²´ ì ìš©
3. **ë³‘ë ¬ ì¤€ë¹„**: ë¬¸ì„œ í…œí”Œë¦¿ ë° í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì‘ì„±

### 2ì£¼ì¼ ë‚´
4. **Wave 2 ì‹¤í–‰**: RLS ì™„ì „ ì ìš©
5. **ëª¨ë‹ˆí„°ë§**: ê° Wave ì™„ë£Œ í›„ í”„ë¡œë•ì…˜ ëª¨ë‹ˆí„°ë§

---

*ì´ ê³„íšì„œëŠ” ì‹¤ì¸¡ ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë©°, ì‹¤ì œ ì§„í–‰ ì‹œ ì¡°ì •ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.*